{"ast":null,"code":"function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nexport var datumValue = function datumValue(datum, property) {\n  var parts = property.split('.');\n\n  if (parts.length === 1) {\n    return datum[property];\n  }\n\n  if (!datum[parts[0]]) {\n    return undefined;\n  }\n\n  return datumValue(datum[parts[0]], parts.slice(1).join('.'));\n};\n\nvar sumReducer = function sumReducer(accumulated, next) {\n  return accumulated + next;\n};\n\nvar minReducer = function minReducer(accumulated, next) {\n  return accumulated === undefined ? next : Math.min(accumulated, next);\n};\n\nvar maxReducer = function maxReducer(accumulated, next) {\n  return accumulated === undefined ? next : Math.max(accumulated, next);\n};\n\nvar reducers = {\n  max: maxReducer,\n  min: minReducer,\n  sum: sumReducer\n};\n\nvar aggregateColumn = function aggregateColumn(column, data) {\n  var value;\n\n  if (column.aggregate === 'avg') {\n    value = data.map(function (d) {\n      return datumValue(d, column.property);\n    }).reduce(sumReducer);\n    value /= data.length;\n  } else {\n    value = data.map(function (d) {\n      return datumValue(d, column.property);\n    }).reduce(reducers[column.aggregate], 0);\n  }\n\n  return value;\n};\n\nvar findPrimary = function findPrimary(nextProps, prevState, nextState) {\n  var columns = nextProps.columns,\n      primaryKey = nextProps.primaryKey;\n  var primaryProperty;\n  columns.forEach(function (column) {\n    // remember the first key property\n    if (column.primary && !primaryProperty) {\n      primaryProperty = column.property;\n    }\n  });\n\n  if (!primaryProperty && columns.length > 0) {\n    primaryProperty = primaryKey || columns[0].property;\n  }\n\n  return _extends({}, nextState, {\n    primaryProperty: primaryProperty\n  });\n}; // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#Escaping\n\n\nvar escapeRegExp = function escapeRegExp(input) {\n  return input.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n};\n\nvar filter = function filter(nextProps, prevState, nextState) {\n  var columns = nextProps.columns,\n      onSearch = nextProps.onSearch;\n  var data = nextState.data,\n      filters = nextState.filters;\n  var nextFilters;\n  var regexps;\n  columns.forEach(function (column) {\n    if (column.search) {\n      if (!nextFilters) {\n        nextFilters = {};\n        regexps = {};\n      }\n\n      nextFilters[column.property] = filters ? filters[column.property] || '' : ''; // don't do filtering if the caller has supplied onSearch\n\n      if (nextFilters[column.property] && column.search && !onSearch) {\n        regexps[column.property] = new RegExp(escapeRegExp(nextFilters[column.property]), 'i');\n      }\n    }\n  });\n  var nextData = data;\n\n  if (nextFilters) {\n    nextData = data.filter(function (datum) {\n      return !Object.keys(regexps).some(function (property) {\n        return !regexps[property].test(datumValue(datum, property));\n      });\n    });\n  }\n\n  return _extends({}, nextState, {\n    filters: nextFilters,\n    data: nextData\n  });\n};\n\nvar aggregate = function aggregate(nextProps, prevState, nextState) {\n  var columns = nextProps.columns;\n  var data = nextState.data;\n  var aggregateValues = {};\n  columns.forEach(function (column) {\n    if (column.aggregate) {\n      aggregateValues[column.property] = aggregateColumn(column, data);\n    }\n  });\n  return _extends({}, nextState, {\n    aggregateValues: aggregateValues\n  });\n};\n\nvar buildFooterValues = function buildFooterValues(nextProps, prevState, nextState) {\n  var columns = nextProps.columns;\n  var aggregateValues = nextState.aggregateValues;\n  var showFooter;\n  var footerValues = {};\n  columns.forEach(function (column) {\n    if (column.footer) {\n      showFooter = true;\n\n      if (typeof column.footer === 'string') {\n        footerValues[column.property] = column.footer;\n      } else if (column.footer.aggregate) {\n        footerValues[column.property] = aggregateValues[column.property];\n      }\n    }\n  });\n  return _extends({}, nextState, {\n    footerValues: footerValues,\n    showFooter: showFooter\n  });\n};\n\nvar sortData = function sortData(nextProps, prevState, nextState) {\n  var sort = prevState.sort;\n  var data = nextState.data;\n  var nextData = data;\n\n  if (sort) {\n    var property = sort.property,\n        ascending = sort.ascending;\n    nextData = [].concat(data);\n    var before = ascending ? 1 : -1;\n    var after = ascending ? -1 : 1;\n    nextData.sort(function (d1, d2) {\n      if (d1[property] > d2[property]) return before;\n      if (d1[property] < d2[property]) return after;\n      return 0;\n    });\n  }\n\n  return _extends({}, nextState, {\n    data: nextData\n  });\n};\n\nvar groupData = function groupData(nextProps, prevState, nextState) {\n  var columns = nextProps.columns,\n      groupBy = nextProps.groupBy;\n  var data = nextState.data;\n  var groups;\n  var groupState;\n  var expandedState;\n\n  if (groupBy) {\n    groups = [];\n    groupState = {};\n    var groupMap = {};\n    data.forEach(function (datum) {\n      var groupByProperty = groupBy.property ? groupBy.property : groupBy;\n      var groupValue = datumValue(datum, groupByProperty);\n\n      if (!groupMap[groupValue]) {\n        var group = {\n          data: [],\n          datum: {},\n          key: groupValue\n        };\n        group.datum[groupByProperty] = groupValue;\n        groups.push(group);\n\n        if (groupBy.expand) {\n          expandedState = groupBy.expand.some(function (key) {\n            return key === groupValue;\n          });\n        } else {\n          expandedState = prevState.groupState && prevState.groupState[groupValue] ? prevState.groupState[groupValue].expanded : false;\n        }\n\n        groupState[groupValue] = {\n          expanded: expandedState\n        };\n        groupMap[groupValue] = group;\n      }\n\n      groupMap[groupValue].data.push(datum);\n    }); // calculate any aggregates\n\n    columns.forEach(function (column) {\n      if (column.aggregate) {\n        groups.forEach(function (group) {\n          group.datum[column.property] = aggregateColumn(column, group.data); // eslint-disable-line\n        });\n      }\n    });\n  }\n\n  return _extends({}, nextState, {\n    groups: groups,\n    groupState: groupState\n  });\n};\n\nexport var buildState = function buildState(nextProps, prevState) {\n  var data = nextProps.data;\n  var filters = prevState.filters,\n      sort = prevState.sort,\n      widths = prevState.widths;\n  var nextState = {\n    data: data,\n    filters: filters,\n    sort: sort,\n    widths: widths\n  };\n  nextState = findPrimary(nextProps, prevState, nextState);\n  nextState = filter(nextProps, prevState, nextState);\n  nextState = aggregate(nextProps, prevState, nextState);\n  nextState = buildFooterValues(nextProps, prevState, nextState);\n  nextState = sortData(nextProps, prevState, nextState);\n  nextState = groupData(nextProps, prevState, nextState);\n  return nextState;\n};","map":{"version":3,"sources":["C:/Users/ruxan/OneDrive/Desktop/UPM/Website/go_bananas/node_modules/grommet/es6/components/DataTable/buildState.js"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","datumValue","datum","property","parts","split","undefined","slice","join","sumReducer","accumulated","next","minReducer","Math","min","maxReducer","max","reducers","sum","aggregateColumn","column","data","value","aggregate","map","d","reduce","findPrimary","nextProps","prevState","nextState","columns","primaryKey","primaryProperty","forEach","primary","escapeRegExp","input","replace","filter","onSearch","filters","nextFilters","regexps","search","RegExp","nextData","keys","some","test","aggregateValues","buildFooterValues","showFooter","footerValues","footer","sortData","sort","ascending","concat","before","after","d1","d2","groupData","groupBy","groups","groupState","expandedState","groupMap","groupByProperty","groupValue","group","push","expand","expanded","buildState","widths"],"mappings":"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","sourcesContent":["function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nexport var datumValue = function datumValue(datum, property) {\n  var parts = property.split('.');\n\n  if (parts.length === 1) {\n    return datum[property];\n  }\n\n  if (!datum[parts[0]]) {\n    return undefined;\n  }\n\n  return datumValue(datum[parts[0]], parts.slice(1).join('.'));\n};\n\nvar sumReducer = function sumReducer(accumulated, next) {\n  return accumulated + next;\n};\n\nvar minReducer = function minReducer(accumulated, next) {\n  return accumulated === undefined ? next : Math.min(accumulated, next);\n};\n\nvar maxReducer = function maxReducer(accumulated, next) {\n  return accumulated === undefined ? next : Math.max(accumulated, next);\n};\n\nvar reducers = {\n  max: maxReducer,\n  min: minReducer,\n  sum: sumReducer\n};\n\nvar aggregateColumn = function aggregateColumn(column, data) {\n  var value;\n\n  if (column.aggregate === 'avg') {\n    value = data.map(function (d) {\n      return datumValue(d, column.property);\n    }).reduce(sumReducer);\n    value /= data.length;\n  } else {\n    value = data.map(function (d) {\n      return datumValue(d, column.property);\n    }).reduce(reducers[column.aggregate], 0);\n  }\n\n  return value;\n};\n\nvar findPrimary = function findPrimary(nextProps, prevState, nextState) {\n  var columns = nextProps.columns,\n      primaryKey = nextProps.primaryKey;\n  var primaryProperty;\n  columns.forEach(function (column) {\n    // remember the first key property\n    if (column.primary && !primaryProperty) {\n      primaryProperty = column.property;\n    }\n  });\n\n  if (!primaryProperty && columns.length > 0) {\n    primaryProperty = primaryKey || columns[0].property;\n  }\n\n  return _extends({}, nextState, {\n    primaryProperty: primaryProperty\n  });\n}; // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#Escaping\n\n\nvar escapeRegExp = function escapeRegExp(input) {\n  return input.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n};\n\nvar filter = function filter(nextProps, prevState, nextState) {\n  var columns = nextProps.columns,\n      onSearch = nextProps.onSearch;\n  var data = nextState.data,\n      filters = nextState.filters;\n  var nextFilters;\n  var regexps;\n  columns.forEach(function (column) {\n    if (column.search) {\n      if (!nextFilters) {\n        nextFilters = {};\n        regexps = {};\n      }\n\n      nextFilters[column.property] = filters ? filters[column.property] || '' : ''; // don't do filtering if the caller has supplied onSearch\n\n      if (nextFilters[column.property] && column.search && !onSearch) {\n        regexps[column.property] = new RegExp(escapeRegExp(nextFilters[column.property]), 'i');\n      }\n    }\n  });\n  var nextData = data;\n\n  if (nextFilters) {\n    nextData = data.filter(function (datum) {\n      return !Object.keys(regexps).some(function (property) {\n        return !regexps[property].test(datumValue(datum, property));\n      });\n    });\n  }\n\n  return _extends({}, nextState, {\n    filters: nextFilters,\n    data: nextData\n  });\n};\n\nvar aggregate = function aggregate(nextProps, prevState, nextState) {\n  var columns = nextProps.columns;\n  var data = nextState.data;\n  var aggregateValues = {};\n  columns.forEach(function (column) {\n    if (column.aggregate) {\n      aggregateValues[column.property] = aggregateColumn(column, data);\n    }\n  });\n  return _extends({}, nextState, {\n    aggregateValues: aggregateValues\n  });\n};\n\nvar buildFooterValues = function buildFooterValues(nextProps, prevState, nextState) {\n  var columns = nextProps.columns;\n  var aggregateValues = nextState.aggregateValues;\n  var showFooter;\n  var footerValues = {};\n  columns.forEach(function (column) {\n    if (column.footer) {\n      showFooter = true;\n\n      if (typeof column.footer === 'string') {\n        footerValues[column.property] = column.footer;\n      } else if (column.footer.aggregate) {\n        footerValues[column.property] = aggregateValues[column.property];\n      }\n    }\n  });\n  return _extends({}, nextState, {\n    footerValues: footerValues,\n    showFooter: showFooter\n  });\n};\n\nvar sortData = function sortData(nextProps, prevState, nextState) {\n  var sort = prevState.sort;\n  var data = nextState.data;\n  var nextData = data;\n\n  if (sort) {\n    var property = sort.property,\n        ascending = sort.ascending;\n    nextData = [].concat(data);\n    var before = ascending ? 1 : -1;\n    var after = ascending ? -1 : 1;\n    nextData.sort(function (d1, d2) {\n      if (d1[property] > d2[property]) return before;\n      if (d1[property] < d2[property]) return after;\n      return 0;\n    });\n  }\n\n  return _extends({}, nextState, {\n    data: nextData\n  });\n};\n\nvar groupData = function groupData(nextProps, prevState, nextState) {\n  var columns = nextProps.columns,\n      groupBy = nextProps.groupBy;\n  var data = nextState.data;\n  var groups;\n  var groupState;\n  var expandedState;\n\n  if (groupBy) {\n    groups = [];\n    groupState = {};\n    var groupMap = {};\n    data.forEach(function (datum) {\n      var groupByProperty = groupBy.property ? groupBy.property : groupBy;\n      var groupValue = datumValue(datum, groupByProperty);\n\n      if (!groupMap[groupValue]) {\n        var group = {\n          data: [],\n          datum: {},\n          key: groupValue\n        };\n        group.datum[groupByProperty] = groupValue;\n        groups.push(group);\n\n        if (groupBy.expand) {\n          expandedState = groupBy.expand.some(function (key) {\n            return key === groupValue;\n          });\n        } else {\n          expandedState = prevState.groupState && prevState.groupState[groupValue] ? prevState.groupState[groupValue].expanded : false;\n        }\n\n        groupState[groupValue] = {\n          expanded: expandedState\n        };\n        groupMap[groupValue] = group;\n      }\n\n      groupMap[groupValue].data.push(datum);\n    }); // calculate any aggregates\n\n    columns.forEach(function (column) {\n      if (column.aggregate) {\n        groups.forEach(function (group) {\n          group.datum[column.property] = aggregateColumn(column, group.data); // eslint-disable-line\n        });\n      }\n    });\n  }\n\n  return _extends({}, nextState, {\n    groups: groups,\n    groupState: groupState\n  });\n};\n\nexport var buildState = function buildState(nextProps, prevState) {\n  var data = nextProps.data;\n  var filters = prevState.filters,\n      sort = prevState.sort,\n      widths = prevState.widths;\n  var nextState = {\n    data: data,\n    filters: filters,\n    sort: sort,\n    widths: widths\n  };\n  nextState = findPrimary(nextProps, prevState, nextState);\n  nextState = filter(nextProps, prevState, nextState);\n  nextState = aggregate(nextProps, prevState, nextState);\n  nextState = buildFooterValues(nextProps, prevState, nextState);\n  nextState = sortData(nextProps, prevState, nextState);\n  nextState = groupData(nextProps, prevState, nextState);\n  return nextState;\n};"]},"metadata":{},"sourceType":"module"}